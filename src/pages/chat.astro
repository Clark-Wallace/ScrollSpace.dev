---
import Layout from '../layouts/Layout.astro';
---

<Layout title="ScrollSpace Chat" description="Retro AOL-style chatroom for ScrollSpace community">
  <!-- Chat App Container -->
  <div id="chat-app"></div>
</Layout>

<script>
  import React from 'react';
  import { createRoot } from 'react-dom/client';
  
  const ChatApp = () => {
    const [AuthProvider, setAuthProvider] = React.useState(null);
    const [AuthNav, setAuthNav] = React.useState(null);
    const [AuthenticatedChatRoom, setAuthenticatedChatRoom] = React.useState(null);
    
    React.useEffect(() => {
      Promise.all([
        import('../components/AuthContext'),
        import('../components/AuthNav'),
        import('../components/AuthenticatedChatRoom')
      ]).then(([authCtx, authNav, chatRoom]) => {
        setAuthProvider(() => authCtx.default);
        setAuthNav(() => authNav.default);
        setAuthenticatedChatRoom(() => chatRoom.default);
      }).catch(err => {
        console.error('Failed to load auth components:', err);
      });
    }, []);
    
    if (!AuthProvider || !AuthNav || !AuthenticatedChatRoom) {
      return React.createElement('div', {
        className: 'min-h-screen bg-black text-green-400 flex items-center justify-center font-mono'
      }, 'LOADING_NEURAL_INTERFACE...');
    }
    
    return React.createElement(AuthProvider, null,
      React.createElement('div', null,
        React.createElement('div', {
          className: 'fixed top-4 right-4 z-50'
        }, React.createElement(AuthNav)),
        React.createElement(AuthenticatedChatRoom)
      )
    );
  };

  const container = document.getElementById('chat-app');
  if (container) {
    const root = createRoot(container);
    root.render(React.createElement(ChatApp));
  }
</script>