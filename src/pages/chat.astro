---
import Layout from '../layouts/Layout.astro';
---

<Layout title="ScrollSpace Chat" description="Retro AOL-style chatroom for ScrollSpace community">
  <!-- Chat App Container -->
  <div id="chat-app"></div>
</Layout>

<script>
  import React from 'react';
  import { createRoot } from 'react-dom/client';
  
  // Define the components inline to avoid SSR issues
  const ChatApp = () => {
    const [AuthProvider, setAuthProvider] = React.useState(null);
    const [AuthNav, setAuthNav] = React.useState(null);
    const [AuthenticatedChatRoom, setAuthenticatedChatRoom] = React.useState(null);
    
    React.useEffect(() => {
      // Dynamically import components to avoid SSR
      Promise.all([
        import('../components/AuthContext'),
        import('../components/AuthNav'),
        import('../components/AuthenticatedChatRoom')
      ]).then(([authCtx, authNav, chatRoom]) => {
        setAuthProvider(() => authCtx.default);
        setAuthNav(() => authNav.default);
        setAuthenticatedChatRoom(() => chatRoom.default);
      });
    }, []);
    
    if (!AuthProvider || !AuthNav || !AuthenticatedChatRoom) {
      return React.createElement('div', {
        className: 'min-h-screen bg-black text-green-400 flex items-center justify-center font-mono'
      }, 'LOADING_NEURAL_INTERFACE...');
    }
    
    return React.createElement(AuthProvider, null,
      React.createElement('div', null,
        // Test element to verify positioning works
        React.createElement('div', {
          className: 'fixed top-4 right-4 z-50',
          style: {
            backgroundColor: 'rgba(255, 0, 0, 0.5)',
            color: 'white',
            padding: '8px',
            border: '2px solid red',
            fontSize: '14px',
            fontFamily: 'monospace'
          }
        }, 'TEST_AUTH_AREA'),
        // Auth nav below the test
        React.createElement('div', {
          className: 'fixed top-16 right-4 z-50',
          style: {
            backgroundColor: 'rgba(0, 255, 0, 0.1)',
            padding: '8px',
            border: '2px solid green'
          }
        }, React.createElement(AuthNav)),
        React.createElement(AuthenticatedChatRoom)
      )
    );
  };

  // Initialize the app
  const container = document.getElementById('chat-app');
  if (container) {
    const root = createRoot(container);
    root.render(React.createElement(ChatApp));
  }
</script>